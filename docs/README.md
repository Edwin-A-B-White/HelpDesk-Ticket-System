# Secure Ticket System with Azure, osTicket, and Active Directory Integration

This project demonstrates how to create a **cloud-based ticketing system** using **osTicket** hosted on **Microsoft Azure**, integrating **Active Directory (AD)** for user authentication. It also includes **system hardening** to reduce the attack surface and improve cybersecurity.

## Features
- **Azure Infrastructure Setup**: Resource groups, virtual networks, and virtual machines.  
- **osTicket Deployment**: Installation and configuration of the ticketing system.  
- **Active Directory Integration**: User management and LDAP authentication.  
- **Cybersecurity Measures**: System hardening, NSG configuration, firewall configuration.  
- **Documentation**: Detailed steps and screenshots.

## Table of Contents
1. [Prerequisites](#prerequisites)  
2. [Step-by-Step Setup](#step-by-step-setup)  
3. [System Hardening](#system-hardening)    
4. [Real-World Use Case](#real-world-use-case)  
5. [Troubleshooting](#troubleshooting)  
6. [Contributing](#contributing)  
7. [License](#license)

---

## Prerequisites
- An active **Azure account**.  
- A **Remote Desktop Protocol (RDP)** client installed on your local machine.  

---

## Step-by-Step Setup

### 1. Set Up Azure Environment

#### 1.1 Create a Resource Group
1. Log in to the [Azure Portal](https://portal.azure.com).
2. Navigate to **Resource Groups** > **Create**.
3. Enter the following details:
   - **Resource Group Name**: `HelpDesk-RG`
   - **Region**: `East US 2`
4. Click **Review + Create**, then **Create**.

#### 1.2 Deploy Two Windows VMs

- **VM 1**: `osticket-vm` (osTicket Server)  
  1. Go to **Virtual Machines** > **Create** > **Virtual Machine**.  
  2. Enter the following details:  
     - **Subscription**: Select your subscription.  
     - **Resource Group**: `HelpDesk-RG`  
     - **Virtual Machine Name**: `osticket-vm`  
     - **Region**: `East US 2`  
     - **Image**: `Windows Server 2022 Datacenter`  
     - **Size**: `Standard_B2s`  
     - **Username**: `azureuser`  
     - **Password**: Use a secure password generated by Azure Key Vault (for testing, `testpassword123!`, or see [Generating Secure Passwords](#best-password-practice)).  
  3. Under **Networking**:  
     - **Virtual Network**: Create new (e.g., `HelpDesk-VNet`).  
     - **Subnet**: Create new (e.g., `osticket-subnet`, `10.0.1.0/24`).  
     - **Public IP**: Ensure a public IP is created.  
  4. Click **Review + Create**, then **Create**.

- **VM 2**: `DC-1` (Active Directory Server)  
  1. Repeat the same steps as above, but with the following changes:  
     - **Virtual Machine Name**: `DC-1`  
     - **Subnet**: Create new (`DC-1-subnet`, `10.0.2.0/24`).  
  ![image](https://github.com/user-attachments/assets/6e31501d-e3d0-4ec5-a2cb-d0be5721c334)
  ![image](https://github.com/user-attachments/assets/4c2677b5-1266-4f01-bfee-1f24608c2b03)
  
---

#### 1.3 Configure Network Security Group (NSG) and Windows Firewall

Since both the osTicket server and the Active Directory (AD) server are running on Windows Server VMs in Azure, configure both the Windows Firewall on each VM and the Azure NSG to allow LDAP communication.

##### Configure Azure NSG Rules

1. **Find the NSG Attached to Your VMs**  
   - Log in to the Azure Portal.  
   - Go to **Virtual Machines**.  
   - Select your `osticket-vm`.  
   - Click **Networking**.  
   - Look for the **Network Security Group (NSG)** and click it.

2. **Add Inbound Rules (for AD Server)**  
   - Click **Inbound Security Rules** > **Add Rule**.  
   - Configure the rule:  
     - **Source**: VirtualNetwork (or `Any` if cross-VNet)  
     - **Destination**: VirtualNetwork  
     - **Protocol**: TCP  
     - **Port Range**: 389, 636, 88, 3268, 3269  
     - **Action**: Allow  
     - **Priority**: 200  
     - **Name**: `Allow-LDAP`

3. **Add Outbound Rules (for osTicket Server)**
   - Click **Outbound Security Rules** > **Add Rule**.  
   - Configure the rule:  
     - **Source**: VirtualNetwork  
     - **Destination**: VirtualNetwork  
     - **Protocol**: TCP  
     - **Port Range**: 389, 636, 88, 3268, 3269  
     - **Action**: Allow  
     - **Priority**: 200  
     - **Name**: `Allow-LDAP-Out`

4. **Repeat for the AD Server**  
   - Follow the same process for your Active Directory VM to ensure it can send and receive LDAP traffic.
![image](https://github.com/user-attachments/assets/242fecab-5c88-42b1-8f2e-2ef2e5d4a775)
##### Configure Windows Firewall on Each VM

Even after configuring Azure NSGs, open the necessary ports on each Windows Server VM.

1. **On Both osTicket & AD Servers**  
   - Press **Win + R**, type `wf.msc`, and press **Enter** to open Windows Firewall.  

2. **Create Inbound Rules**  
   - Click **Inbound Rules** > **New Rule**.  
   - Select **Port** and click **Next**.  
   - Choose **TCP** and enter the ports:  
     ```
     389, 636, 88, 3268, 3269
     ```
   - Click **Next**, select **Allow the Connection**, and click **Next**.  
   - Apply to **Domain**, **Private**, and **Public** profiles.  
   - Name it `Allow LDAP Traffic` and click **Finish**.

3. **Create Outbound Rules**  
   - Repeat the same steps, but select **Outbound Rules** this time.  
![image](https://github.com/user-attachments/assets/03cca3ee-57e2-4b0c-b16d-368f2ba4f290)

---

### 2. Install and Configure osTicket

#### 2.1 Connect to `osticket-vm`
 If you have are not connected to the osticket-vm
1. In the Azure Portal, go to **Virtual Machines** > `osticket-vm` > **Connect** > **RDP**.  
2. Download the RDP file and open it.  
3. Log in with the username `azureuser` and the password you set earlier.  

#### 2.2 Install XAMPP
1. **Download XAMPP**  
   - Open Microsoft Edge and go to the [XAMPP Download page](https://www.apachefriends.org/index.html).  
   - Download the installer for the latest version of XAMPP compatible with Windows Server.

2. **Run the XAMPP Installer**  
   - Double-click the installer to launch it.  
   - If prompted by User Account Control (UAC), click **Yes**.  

3. **Select Components**  
   - In the **Setup** window, select:
     - **Apache**  
     - **MySQL**  
     - **PHP**  
     - **phpMyAdmin** (optional but recommended)  

4. **Choose Installation Directory**  
   - Leave the default (`C:\xampp`) or specify a different location.  
   - Click **Next**.

5. **Complete the Installation**  
   - Click **Next** to proceed.  
   - Once finished, check the box to **Start the Control Panel** and click **Finish**.

6. **Start Apache and MySQL**  
   - In the XAMPP Control Panel, click **Start** beside **Apache** and **MySQL**.  
   - Ensure both services are running (status will turn green).

7. **Edit PHP Configuration**  
   - Navigate to `C:\xampp\php\` and open `php` configuration file.  
   - Remove the semicolon (`;`) in front of these extensions (uncomment them):  
     ```
     extension=imap
     extension=intl
     zend_extension=opcache
     extension=gd
     ```
   - Save `php`.  
   - Stop and start Apache and MySQL in the XAMPP Control Panel.
     ![image](https://github.com/user-attachments/assets/313488c0-341a-4867-b500-51eac79a4766)
     ![image](https://github.com/user-attachments/assets/856f60a9-371a-4538-a3e1-5237c3ad8c5d)

8. **Create Database for osTicket**  
   - Open [http://localhost/dashboard](http://localhost/dashboard) and select **phpMyAdmin**.  
   - Click **New** to create a new database (e.g., `osticket`).  
   - Set password for user `root` hostname `localhost` for the `osticket` database:
     - Password: `testpassword123!` or secure password    
    - You will now lose access to phpMyAdmin with the default password.  
  ![image](https://github.com/user-attachments/assets/facab537-0d5b-448f-862e-4f4844c1338f)
  ![image](https://github.com/user-attachments/assets/411c24d6-1607-4abb-9965-a08b7f43847f)
  ![image](https://github.com/user-attachments/assets/453deded-527c-481c-944a-e3e3b63dcfa5)
   - Go to `C:\xampp\phpMyAdmin` and open `config.inc.php` in a text editor.  
   - Change the server authentication info to:
     ```php
     /* Authentication type and info */
     $cfg['Servers'][$i]['auth_type'] = 'config';
     $cfg['Servers'][$i]['user'] = 'root';
     $cfg['Servers'][$i]['password'] = 'testpassword123!';
     $cfg['Servers'][$i]['extension'] = 'mysqli';
     $cfg['Servers'][$i]['AllowNoPassword'] = false;
     $cfg['Lang'] = '';
     ```
  ![image](https://github.com/user-attachments/assets/a66a1cb5-50cf-4544-967f-df21f625e1dc)
  ![image](https://github.com/user-attachments/assets/1d9b5dd7-dbd1-4b53-9329-c2e35228ec5a)
---

### 3. Download and Install osTicket

1. **Download osTicket**  
   - Open Microsoft Edge and go to the [osTicket Download page](https://osticket.com/download/).  
   - Download the latest version (e.g., `osticket-v1.18.zip`).

2. **Extract osTicket Files**  
   - Locate the downloaded `.zip` file and **Extract All**.  
   - Open the extracted folder (e.g., `C:\osticket\osticket-v1.18`).  
   - Inside, find the `upload` folder, which contains the actual osTicket app.

3. **Create osTicket Directory in XAMPP**  
   - Navigate to `C:\xampp\htdocs`.  
   - Create a new folder named `osticket`.

4. **Copy osTicket Files**  
   - Copy all contents of the `upload` folder.  
   - Paste them into `C:\xampp\htdocs\osticket`.

5. **Rename Config File**  
   - Inside `C:\xampp\htdocs\osticket\include`, rename `ost-sampleconfig.php` to `ost-config.php`.

---

### 4. Configure osTicket

1. **Start Apache and MySQL**  
   - Ensure **Apache** and **MySQL** are running in the XAMPP Control Panel.

2. **Access osTicket Setup**  
   - Open a browser and go to `http://localhost/osticket/setup`.

3. **Configure osTicket Settings**  
   - **System Settings**:  
     - **Helpdesk Name**: `HelpDesk`  
     - **Default Email**: `help@helpdesk.local`  
   - **Admin User**:  
     - **Email**: `admin@helpdesk.local`
     - **Name**: `admin user`  
     - **Username**: `adminUser`  
     - **Password**: `testpassword123!` (or a securely generated password)  
   - **Database Settings**:  
     - **MySQL Database**: `osticket`  
     - **MySQL Username**: `root`  
     - **MySQL Password**: `testpassword123!`  
     - **MySQL Host**: `localhost`
  ![image](https://github.com/user-attachments/assets/1e6089b6-901a-4753-99e3-d1c0286237b5)
  ![image](https://github.com/user-attachments/assets/16f0ddb5-2dbe-46ce-a4c1-9bf824d864ab)
4. **Complete the Setup**  
   - Click **Install Now**.  
   - Once the installation completes, **delete the `setup` folder** from `C:\xampp\htdocs\osticket` for security.  
   - Remove write permissions from `ost-config.php` in `C:\xampp\htdocs\osticket\include`.

---

### 5. Set Up Active Directory

#### 5.1 Promote `DC-1` to a Domain Controller

1. Connect to `DC-1` via RDP.  
2. Open **Server Manager**.  
3. Click **Add Roles and Features**.  
4. Select **Role-based or feature-based installation** and click **Next**.  
5. Select the server (`DC-1`) and click **Next**.  
6. Check the box for **Active Directory Domain Services**.
   ![image](https://github.com/user-attachments/assets/184bd1f0-53fb-4c69-bae6-973ea90cea33)
   ![image](https://github.com/user-attachments/assets/815a411b-4a69-4685-b8a7-63a232b0f62d)
7. Click **Add Features** when prompted, then **Next**.  
8. Click **Next** through the Features section and then **Install**.  
9. After installation, click **Promote this server to a domain controller**.  
10. In **Deployment Configuration**, select **Add a new forest** and enter a root domain name (e.g., `helpdesk.local`).  
11. **Domain Controller Options**:  
    - **Forest Functional Level**: `Windows Server 2016`  
    - **Domain Functional Level**: `Windows Server 2016`  
    - **DSRM Password**: `testpassword123!` or secure password
12. Click **Next** through the remaining steps and **Install**. The server will restart automatically.
13. To sign back into with remote desktop include the domain name `HELPDESK\` in front of the vm username.
    ![image](https://github.com/user-attachments/assets/8fc21d95-d6a0-44bb-aa6d-a55faed090fb)


#### 5.2 Create Users and Groups

1. Open **Active Directory Users and Computers** from the **Tools** menu in Server Manager.  
2. Create the following **Organizational Units (OUs)**:  
   - Right-click the domain (`helpdesk.local`) > **New > Organizational Unit**:  
     - `HelpDesk`, `IT`, and `EndUsers`.
3. Create Groups:  
   - In `HelpDesk` OU: `HelpDeskAgents`  
   - In `IT` OU: `ITAdmins`
4. Create Users:  
   - In `HelpDesk` OU: `agent one` (username: `agent1`), add to `HelpDeskAgents`.  
   - In `IT` OU: `admin one` (username: `admin1`), add to `ITAdmins`.  
   - Use secure passwords or `testpassword123!` for testing.

---

### 6. Integrate osTicket with Active Directory

1. **Install LDAP Plugin**  
   - In the osticket download copy `auth-ldap.phar` 
   - Paste in the `include/plugins` directory of osTicket (e.g., `C:\xampp\htdocs\osticket\include\plugins`).
2. **Set osticket-vm DNS server to DC-1 VM private IP**
   - Log in to the [Azure Portal](https://portal.azure.com).  
   - Navigate to **Virtual machines** and select `osticket-vm`.  
   - Under **Settings**, click **Networking** > **Network interface**.  
   - On the **Overview** page for the NIC, click **DNS servers**.  
   - Select **Custom**, then enter the private IP address of your DC-1 VM (e.g., `10.0.2.5`).  
   - Click **Save**.  
   - Restart your VM(s) in that VNet so they pick up the updated DNS configuration (or at least **restart network services** on each VM).
3. **Configure LDAP in osTicket**  
   - Log in to osTicket as `adminUser`.  
   - Go to **Admin Panel** > **Plugins** > **LDAP**.  
   - Configure LDAP settings:  
     - **Domain**: `helpdesk.local`  
     - **Base DN**: `DC=helpdesk,DC=local`  
     - **Bind DN**: `CN=admin one,CN=Users,DC=helpdesk,DC=local` (or the path to your AD admin user)  
     - **Bind Password**: Password for `admin one`
        ![image](https://github.com/user-attachments/assets/9568b40b-05e7-43ce-925d-48552f6ef81d)
4. **Test the LDAP connection**
    Create a New User with AD credentials
    - Log in to osTicket Admin Panel
      - Open your web browser 
      - Log in using an administrator account and navigate to the osTicket admin panel.
    
   - **Navigate to User Management**
     - Go to `Users` > `Add New User`.
   - **Enter User Details**
     - **Full Name**: Enter the AD user's full name.
     - **Username**: Enter the AD user's username.
     - **Email Address**: Enter the user’s email (must match the one in Active Directory).
     - **Phone Number**: (Optional) Enter the user's phone number.
   - **Enable AD Authentication**
     - Check if the LDAP plugin is configured correctly.
     - Ensure that the user exists in Active Directory with a valid email.
   - **Save the User**
     - Click the **Create User** button.
     - Sign into osTicket with AD credentials

--- 


## System Hardening

Below are some core hardening measures implemented and a few additional recommendations:

- **Disabled Unused Services**:  
  - Telnet  
  - FTP  

- **Windows Firewall Configuration**:  
  - Allow HTTP (80)  
  - Allow HTTPS (443)  
  - Allow RDP (3389) **from specific IPs only**  
  - Allow LDAP Ports (389, 636)  
  - Allow Kerberos (88)  
  - Allow Active Directory Web Services (9389)  
  - Allow Global Catalog Ports (3268, 3269)

- **Apply Latest Windows Server 2022 Security Updates**:  
  - Keep all software up to date via **Windows Update** or **WSUS**.
- **Enable Network Level Authentication (NLA)** for RDP to reduce unauthorized access attempts.  
- **Install/Enable Windows Defender** (or another reputable antivirus/antimalware solution) on each VM.  
- **Restrict Administrative Privileges**:  
  - Use separate accounts for administrative tasks vs. day-to-day tasks.  
  - Employ Role-Based Access Control (RBAC) in Azure.  
- **Disk Encryption** with BitLocker:  
  - Helps protect data at rest on the VMs.  
- **Configure a Domain Policy for Strong Passwords**:  
  - Enforce length, complexity, and rotation intervals.  

---

## Real-World Use Case

This ticketing system can be used in various real-world scenarios:

1. **Small Business IT Helpdesk**  
   - Provide employees with a centralized platform to submit IT support tickets.  
   - Use Active Directory integration for streamlined user authentication and role-based access control.

2. **Educational Institutions**  
   - Allow students and staff to submit tickets for IT issues (e.g., password resets, software installations).  
   - Use Active Directory to manage user accounts and permissions.

---

## Best Password Practice

1. **Use Azure Key Vault for Secrets**
   - You must have Azure CLI installed and be signed in.
   - Avoid using easy-to-guess passwords like `testpassword123!` in production.  
   - Create an Azure Key Vault:  
     ```bash
     az keyvault create \
       --name HelpDesk-KV \
       --resource-group HelpDesk-RG \
       --location EastUS
     ```
   - Store passwords securely:  
     ```bash
     az keyvault secret set \
       --vault-name HelpDesk-KV \
       --name "osticket-vm-password" \
       --value "YourSecurePassword123!"
     ```
   - Retrieve passwords during setup:  
     ```bash
     az keyvault secret show \
       --vault-name HelpDesk-KV \
       --name "osticket-vm-password" \
       --query "value" -o tsv
     ```

2. **Enable Multi-Factor Authentication (MFA)**  
   - In the Azure Portal, go to **Azure Active Directory** > **Security** > **MFA**.  
   - Enable MFA for all users, especially **admin** or privileged accounts.  
   - (Optional for a lab environment but crucial in production.)

---

## Troubleshooting

### Common Issues and Solutions

1. **XAMPP Fails to Start Apache or MySQL**  
   - **Cause**: Port conflicts (e.g., another service using port 80 or 3306).  
   - **Solution**:  
     - In XAMPP Control Panel, click **Config** next to Apache.  
     - Change the port in `httpd.conf` from `80` to `8080`.  
     - Restart Apache. Access osTicket at `http://localhost:8080/osticket`.

2. **Failed LDAP Integration**  
   - **Cause**: Incorrect Bind DN or password.  
   - **Solution**:  
     - Verify the Bind DN/password in osTicket’s LDAP settings.  
     - Test the LDAP connection using `ldp.exe` on `DC-1`.  
       - Open `ldp.exe` > **Connection** > **Bind**.  
       - Enter the Bind DN and password, then click **OK**.  
     - If bind fails, check AD user account permissions.  
     - (Optional) Install Wireshark on `DC-1` to monitor ports 389 (LDAP) and 636 (LDAPS) to confirm or diagnose authentication issues.

---

## Contributing

Contributions are welcome! Please open an issue or submit a pull request.

---

## **License**
This project is licensed under the MIT License. See the [LICENSE](https://github.com/Edwin-A-B-White/HelpDesk-Ticket-System/blob/main/LICENSE) file for details.
